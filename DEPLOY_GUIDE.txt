# 局域网游戏文件同步工具 - 部署指南

## 一、准备二进制文件

### 1. 下载Syncthing
- 访问: https://github.com/syncthing/syncthing/releases
- 下载Windows版本（syncthing-windows-amd64-vX.X.X.zip）
- 解压后将`syncthing.exe`复制到`resources/`目录

### 2. 下载Easytier
- 访问: https://github.com/EasyTier/EasyTier/releases
- 下载Windows版本（easytier-windows-x86_64.zip）
- 解压后将`easytier-core.exe`复制到`resources/`目录

## 二、安装依赖

```bash
pip install -r requirements.txt
```

## 三、测试运行

```bash
python main.py
```

## 四、打包为可执行文件

### 方法1：使用spec文件（推荐）
```bash
pyinstaller langamesync.spec
```

### 方法2：直接打包
```bash
pyinstaller --onefile --windowed --name=LanGameSync ^
    --add-data "resources/syncthing.exe;resources" ^
    --add-data "resources/easytier-core.exe;resources" ^
    --hidden-import PyQt5.QtCore ^
    --hidden-import PyQt5.QtGui ^
    --hidden-import PyQt5.QtWidgets ^
    main.py
```

打包完成后，可执行文件在`dist/`目录下。

## 五、使用说明

### 单机使用
1. 运行`LanGameSync.exe`
2. 点击"添加目录"选择游戏文件夹（如C:/GAME）
3. 点击"开始同步"

### 多设备同步
1. 确保所有设备连接到同一局域网
2. 在每台设备上运行软件
3. 添加相同类型的游戏目录
4. 点击"开始同步"
5. 软件自动发现其他设备并配对
6. 等待同步完成

## 六、常见问题

### Q1: 提示"未发现局域网设备"
**原因**: 
- 其他设备未启动软件
- 防火墙阻止了通信
- 网络隔离

**解决**:
1. 确保所有设备都运行了软件
2. 关闭防火墙或添加例外规则
3. 检查路由器是否启用了AP隔离

### Q2: Syncthing启动失败
**原因**: 端口8384被占用

**解决**:
1. 修改`config.py`中的`SYNCTHING_API_PORT`
2. 或关闭占用端口的程序

### Q3: 同步速度慢
**原因**: 
- 文件过大
- 网络带宽不足
- 磁盘IO瓶颈

**解决**:
1. 升级网络设备（千兆路由器/网线）
2. 使用SSD存储
3. 减少同时同步的文件数量

### Q4: 打包后无法运行
**原因**: 缺少资源文件

**解决**:
1. 确保`resources/`目录包含所有二进制文件
2. 检查spec文件中的`datas`配置
3. 查看日志文件（用户目录/.langamesync/logs/）

## 七、进阶配置

### 修改网络名称和密钥
编辑`config.py`:
```python
EASYTIER_NETWORK_NAME = "my-game-network"
EASYTIER_NETWORK_SECRET = "my-secret-key"
```
**注意**: 所有设备必须使用相同的配置

### 自定义同步参数
编辑`managers/syncthing_manager.py`中的`add_folder`方法，调整:
- `rescanIntervalS`: 扫描间隔（秒）
- `fsWatcherEnabled`: 是否启用文件监控
- `fsWatcherDelayS`: 文件变更延迟（秒）

## 八、技术架构总结

```
应用层 (PyQt5 GUI)
    ↓
业务层 (SyncController)
    ↓
服务层 (SyncthingManager + EasytierManager)
    ↓
工具层 (Syncthing + Easytier 二进制)
```

### 核心流程
1. Easytier创建虚拟局域网，分配虚拟IP
2. 发现网络中的其他设备
3. 通过虚拟IP访问对方Syncthing API
4. 获取设备ID并添加到配置
5. 创建共享文件夹
6. Syncthing执行双向实时同步

### 优化建议
1. **性能优化**: 
   - 使用`ignorePerms=True`忽略权限检查
   - 调整`hashers`和`copiers`并发数
   
2. **安全优化**:
   - 修改默认API密钥
   - 启用Easytier加密传输
   
3. **用户体验**:
   - 添加托盘图标
   - 支持开机自启动
   - 显示传输速度

## 九、开发扩展

### 添加新功能
1. **冲突解决**: 实现版本控制策略
2. **选择性同步**: 支持文件/文件夹过滤
3. **传输限速**: 限制带宽占用
4. **远程管理**: Web控制台

### 跨平台适配
- **macOS**: 替换`.exe`为macOS二进制，调整路径分隔符
- **Linux**: 使用Linux版Syncthing/Easytier，处理权限问题

## 十、许可与致谢

本软件基于以下开源项目:
- Syncthing (MPL-2.0)
- Easytier (Apache-2.0)
- PyQt5 (GPL)

感谢开源社区的贡献！
