
>     def connect_to_network(self):
          """连接到网络（异步�?""
          if self.is_connected:
              QMessageBox.information(self, "
提示", "已经连接到网络了")
              return
          
          room_name = self.room_input.text().
strip()
          password = self.password_input.text
().strip()
          
          if not room_name or not password:
              QMessageBox.warning(self, "警告",
 "请输入房间名称和密码")
              return
          
          # 禁用连接按钮
          self.connect_btn.setEnabled(False)
          self.connect_btn.setText("连接�?..")
          
          # 更新配置
          Config.EASYTIER_NETWORK_NAME = room
_name
          Config.EASYTIER_NETWORK_SECRET = pa
ssword
          
          # 更新公共节点配置
          peer_text = self.peer_combo.current
Data()
          if peer_text:
              # 按逗号分割并去除空�?
              Config.EASYTIER_PUBLIC_PEERS = 
[p.strip() for p in peer_text.split(',') if p
.strip()]
          else:
              # 不使用公共节�?
              Config.EASYTIER_PUBLIC_PEERS = 
[]
          
          # 创建连接线程
          self.connect_thread = ConnectThread
(self.controller, room_name, password)
          self.connect_thread.progress.connec
t(self.on_connect_progress)
          self.connect_thread.connected.conne
ct(self.on_connected)
          self.connect_thread.start()
      
      def on_connect_progress(self, message):
          """连接进度回调"""
          self.status_label.setText(f"状�? {me
ssage}")
      
      def on_connected(self, success, message
):
          """连接完成回调"""
          if success:
              self.is_connected = True
              virtual_ip = message
              self.connect_btn.setText("断开连接"
)
              self.connect_btn.setEnabled(Tru
e)
              self.connect_btn.clicked.discon
nect()
              self.connect_btn.clicked.connec
t(self.disconnect_from_network)
              self.connect_btn.setStyleSheet(
"""
                  QPushButton#connectBtn {
                      background: #fa5151;
                      color: #ffffff;
                      border: none;
                  }
                  QPushButton#connectBtn:hove
r {
                      background: #e04444;
                  }
              """)
              self.status_label.setText(f"状�?
 已连接到房间 '{self.room_input.text()}' | 虚拟IP: {v
irtual_ip}")
              
              # 初始�?discovered_devices，添加本�?
              self.controller.discovered_devi
ces = [{
                  "ip": virtual_ip,
                  "device_id": self.controlle
r.syncthing.device_id,
                  "name": "本机",
                  "hostname": "localhost"
              }]
              
              # 启动设备监听
              self.scan_timer = QTimer()
              self.scan_timer.timeout.connect
(self.background_scan_devices)
              self.scan_timer.start(5000)  # 
初始5�?
              
              # 播放连接成功动画
              self.play_connect_animation()
          else:
              self.connect_btn.setText("连接到网�
?)
              self.connect_btn.setEnabled(Tru
e)
              self.status_label.setText(f"状�?
 连接失败 - {message}")
              QMessageBox.critical(self, "错误"
, f"连接失败: {message}")


